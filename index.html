<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>T√†i X·ªâu Vui</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: linear-gradient(to bottom, #1a0f0f, #000); font-family: "Poppins", sans-serif; }
    .card { background: #2b1a1a; border-radius: 20px; box-shadow: 0px 4px 20px rgba(0,0,0,0.6); }
    .btn { background: linear-gradient(to right, #facc15, #f59e0b); border-radius: 12px; font-weight: bold; padding: 10px 20px; transition: 0.2s; }
    .btn:hover { transform: scale(1.05); box-shadow: 0 0 15px #facc15aa; }
    .chosen { border: 3px solid #facc15; box-shadow: 0 0 20px #facc15aa; }
  </style>
</head>
<body class="text-white flex justify-center items-center min-h-screen">

  <!-- M√†n h√¨nh ƒëƒÉng nh·∫≠p -->
  <div id="loginScreen" class="card p-8 text-center w-[400px]">
    <h1 class="text-3xl font-bold text-yellow-400 mb-4">üé≤ T√ÄI X·ªàU VUI üé≤</h1>
    <p class="mb-2">T√™n t√†i kho·∫£n:</p>
    <input id="usernameInput" type="text" placeholder="T√™n ƒëƒÉng nh·∫≠p..." class="w-full p-2 rounded text-black mb-3">
    <p class="mb-2">M·∫≠t kh·∫©u:</p>
    <input id="passwordInput" type="password" placeholder="M·∫≠t kh·∫©u..." class="w-full p-2 rounded text-black mb-4">
    <button class="btn w-full mb-2" onclick="login()">ƒêƒÇNG NH·∫¨P</button>
    <button class="btn w-full bg-green-500" onclick="register()">ƒêƒÇNG K√ù</button>
  </div>

  <!-- M√†n h√¨nh game -->
  <div id="gameScreen" class="hidden w-[1200px] p-6 card text-center">
    <h1 class="text-3xl font-bold mb-6 text-yellow-400">üé≤ T√ÄI X·ªàU üé≤</h1>
    <p class="mb-6 text-lg">üë§ Ng∆∞·ªùi ch∆°i: <span id="playerName" class="text-green-400 font-bold"></span></p>

    <!-- Khu ƒë·∫∑t c∆∞·ª£c -->
    <div class="grid grid-cols-3 gap-6 items-center">
      <!-- T√ÄI -->
      <div id="taiCard" class="card p-6">
        <h2 class="text-2xl font-bold">T√ÄI</h2>
        <p class="text-yellow-300 text-lg">Ng∆∞·ªùi ch∆°i: <span id="taiPlayers">0</span></p>
        <p class="mt-1 text-yellow-400 text-lg">ƒêi·ªÉm: <span id="taiScore">0</span></p>
        <button id="btnTai" class="btn mt-4" onclick="chooseSide('tai')">CH·ªåN T√ÄI</button>
      </div>

      <!-- ƒê·ªìng h·ªì + ƒëi·ªÉm -->
      <div class="flex flex-col items-center">
        <div class="w-28 h-28 rounded-full border-8 border-yellow-400 flex items-center justify-center text-3xl font-bold">
          <span id="timer">20</span>
        </div>
        <div class="flex space-x-2 mt-4">
          <button class="btn" onclick="addPoint(1000)">1K</button>
          <button class="btn" onclick="addPoint(10000)">10K</button>
          <button class="btn" onclick="addPoint(50000)">50K</button>
        </div>
        <div class="flex space-x-2 mt-2">
          <button class="btn" onclick="addPoint(100000)">100K</button>
          <button class="btn" onclick="addPoint(5000000)">5M</button>
          <button class="btn" onclick="addPoint(10000000)">10M</button>
        </div>
        <div class="flex space-x-2 mt-2">
          <button class="btn bg-purple-600" onclick="allIn()">ALL-IN</button>
          <button class="btn bg-green-600" onclick="confirmBet()">ƒê·∫∂T C∆Ø·ª¢C</button>
          <button class="btn bg-red-600" onclick="cancelBet()">H·ª¶Y</button>
        </div>
      </div>

      <!-- X·ªàU -->
      <div id="xiuCard" class="card p-6">
        <h2 class="text-2xl font-bold">X·ªàU</h2>
        <p class="text-yellow-300 text-lg">Ng∆∞·ªùi ch∆°i: <span id="xiuPlayers">0</span></p>
        <p class="mt-1 text-yellow-400 text-lg">ƒêi·ªÉm: <span id="xiuScore">0</span></p>
        <button id="btnXiu" class="btn mt-4" onclick="chooseSide('xiu')">CH·ªåN X·ªàU</button>
      </div>
    </div>

    <!-- Chat, Tr·∫°ng th√°i, B·∫£ng x·∫øp h·∫°ng -->
    <div class="mt-8 grid grid-cols-3 gap-4">
      <!-- Chat -->
      <div class="col-span-1 card p-4 text-left">
        <h3 class="font-bold text-yellow-300 mb-2">üí¨ Chat Box</h3>
        <div id="chatBox" class="h-40 overflow-y-auto bg-black/40 p-2 rounded"></div>
        <div class="flex mt-2">
          <input id="chatInput" type="text" placeholder="Nh·∫≠p tin nh·∫Øn..." class="flex-1 p-2 rounded text-black" onkeydown="if(event.key==='Enter') sendChat()">
          <button class="btn ml-2" onclick="sendChat()">G·ª≠i</button>
        </div>
      </div>

      <!-- Tr·∫°ng th√°i -->
      <div class="card p-4">
        <h3 class="font-bold text-yellow-300">üìä Tr·∫°ng th√°i</h3>
        <p class="mt-2">ƒêi·ªÉm c·ªßa b·∫°n: <span id="myPoints" class="font-bold text-green-400">0</span></p>
        <p class="mt-1">C∆∞·ª£c t·∫°m: <span id="betTemp" class="text-yellow-400">0</span></p>
        <p class="mt-1">C·ª≠a: <span id="betSide" class="text-red-400">Ch∆∞a ch·ªçn</span></p>
        <p class="mt-1">K·∫øt qu·∫£: <span id="result" class="text-yellow-400 font-bold">ƒêang ch·ªù...</span></p>
      </div>

      <!-- B·∫£ng x·∫øp h·∫°ng -->
      <div class="card p-4">
        <h3 class="font-bold text-yellow-300 mb-2">üèÜ Top 100</h3>
        <div class="h-40 overflow-y-auto">
          <table class="w-full text-sm text-left">
            <thead>
              <tr class="text-yellow-400">
                <th class="px-2">#</th>
                <th class="px-2">T√™n</th>
                <th class="px-2">ƒêi·ªÉm</th>
              </tr>
            </thead>
            <tbody id="leaderboard"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    let timer = 20, countdown;
    let myPoints = 0, betTemp = 0, betTempSaved = 0, betSide = null, hasChosenSide = false;
    let taiScore = 0, xiuScore = 0, taiPlayers = 0, xiuPlayers = 0;
    let playerName = "";

    // ================= AUTH ==================
    function register() {
      let user = document.getElementById("usernameInput").value.trim();
      let pass = document.getElementById("passwordInput").value.trim();
      if (!user || !pass) { alert("Nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!"); return; }
      if (localStorage.getItem("user_" + user)) { alert("T√™n ƒë√£ t·ªìn t·∫°i!"); return; }
      let data = {username: user, password: pass, points: 1000000};
      localStorage.setItem("user_" + user, JSON.stringify(data));
      alert("ƒêƒÉng k√Ω th√†nh c√¥ng! B·∫°n c√≥ 1,000,000 ƒëi·ªÉm.");
    }

    function login() {
      let user = document.getElementById("usernameInput").value.trim();
      let pass = document.getElementById("passwordInput").value.trim();
      let data = localStorage.getItem("user_" + user);
      if (!data) { alert("Kh√¥ng t√¨m th·∫•y t√†i kho·∫£n!"); return; }
      let obj = JSON.parse(data);
      if (obj.password !== pass) { alert("Sai m·∫≠t kh·∫©u!"); return; }
      playerName = obj.username;
      myPoints = obj.points;
      document.getElementById("playerName").textContent = playerName;
      document.getElementById("myPoints").textContent = myPoints.toLocaleString();
      document.getElementById("loginScreen").classList.add("hidden");
      document.getElementById("gameScreen").classList.remove("hidden");
      updateLeaderboard();
      loadChatHistory();
      startTimer();
    }

    function saveData() {
      let old = JSON.parse(localStorage.getItem("user_" + playerName));
      let data = {username: playerName, password: old.password, points: myPoints};
      localStorage.setItem("user_" + playerName, JSON.stringify(data));
    }

    // ================= GAME ==================
    function startTimer() {
      timer = 20;
      document.getElementById("timer").textContent = timer;
      countdown = setInterval(() => {
        timer--;
        document.getElementById("timer").textContent = timer;
        if (timer <= 0) { clearInterval(countdown); rollDice(); }
      }, 1000);
    }

    function addPoint(val) { betTemp += val; document.getElementById("betTemp").textContent = betTemp.toLocaleString(); }
    function allIn() { betTemp = myPoints; document.getElementById("betTemp").textContent = betTemp.toLocaleString(); }
    function chooseSide(side) {
      if (hasChosenSide) return;
      betSide = side; hasChosenSide = true;
      document.getElementById("betSide").textContent = side.toUpperCase();
      if (side === "tai") { document.getElementById("taiCard").classList.add("chosen"); document.getElementById("btnXiu").disabled = true; }
      else { document.getElementById("xiuCard").classList.add("chosen"); document.getElementById("btnTai").disabled = true; }
    }

    function confirmBet() {
      if (!betSide || betTemp === 0) { alert("B·∫°n ch∆∞a ch·ªçn c·ª≠a ho·∫∑c ch∆∞a nh·∫≠p ƒëi·ªÉm!"); return; }
      if (betTemp > myPoints) { alert("B·∫°n kh√¥ng ƒë·ªß ƒëi·ªÉm!"); return; }
      myPoints -= betTemp; betTempSaved = betTemp;
      document.getElementById("myPoints").textContent = myPoints.toLocaleString();
      if (betSide === "tai") { taiScore += betTemp; taiPlayers++; document.getElementById("taiScore").textContent = taiScore.toLocaleString(); document.getElementById("taiPlayers").textContent = taiPlayers; }
      else { xiuScore += betTemp; xiuPlayers++; document.getElementById("xiuScore").textContent = xiuScore.toLocaleString(); document.getElementById("xiuPlayers").textContent = xiuPlayers; }
      betTemp = 0; document.getElementById("betTemp").textContent = 0;
    }
    function cancelBet() { betTemp = 0; betTempSaved = 0; document.getElementById("betTemp").textContent = 0; }

    function resetRound() {
      betTemp = 0; betTempSaved = 0; betSide = null; hasChosenSide = false;
      document.getElementById("betTemp").textContent = 0; document.getElementById("betSide").textContent = "Ch∆∞a ch·ªçn";
      document.getElementById("taiCard").classList.remove("chosen"); document.getElementById("xiuCard").classList.remove("chosen");
      document.getElementById("btnTai").disabled = false; document.getElementById("btnXiu").disabled = false;
    }

    function rollDice() {
      let d1 = Math.floor(Math.random()*6)+1, d2 = Math.floor(Math.random()*6)+1, d3 = Math.floor(Math.random()*6)+1;
      let total = d1+d2+d3, result = total >= 11 ? "tai" : "xiu";
      document.getElementById("result").textContent = `üé≤ ${d1} + ${d2} + ${d3} = ${total} ‚ûù ${result.toUpperCase()}`;
      
      if (betSide) {
        if (betSide === result) { myPoints += betTempSaved*2; }
        else {
          if (taiScore === xiuScore) { myPoints += betTempSaved; } // tr·∫£ n·∫øu h√≤a
        }
        document.getElementById("myPoints").textContent = myPoints.toLocaleString();
      }

      saveData(); updateLeaderboard(); resetRound();
      taiScore=0; xiuScore=0; taiPlayers=0; xiuPlayers=0;
      document.getElementById("taiScore").textContent=0; document.getElementById("xiuScore").textContent=0;
      document.getElementById("taiPlayers").textContent=0; document.getElementById("xiuPlayers").textContent=0;
      startTimer();
    }

    // ================= LEADERBOARD ==================
    function updateLeaderboard() {
      let players = [];
      for (let i=0;i<localStorage.length;i++) {
        let key = localStorage.key(i);
        if (key.startsWith("user_")) {
          let obj = JSON.parse(localStorage.getItem(key));
          players.push({name: obj.username, score: obj.points});
        }
      }
      players.sort((a,b)=>b.score-a.score);
      let top = players.slice(0,100);
      let html="";
      top.forEach((p,idx)=>{
        html += `<tr class="${p.name===playerName?'bg-yellow-700/40 font-bold':''}">
          <td class="px-2">${idx+1}</td><td class="px-2">${p.name}</td><td class="px-2">${p.score.toLocaleString()}</td></tr>`;
      });
      document.getElementById("leaderboard").innerHTML = html;
    }

    // ================= CHAT ==================
    function loadChatHistory() {
      let chatBox=document.getElementById("chatBox");
      chatBox.innerHTML="";
      let history=JSON.parse(localStorage.getItem("chat_history")||"[]");
      history.forEach(msg=>{
        let p=document.createElement("p");
        p.innerHTML=`<span class="text-green-400">${msg.user}:</span> ${msg.text}`;
        chatBox.appendChild(p);
      });
      chatBox.scrollTop=chatBox.scrollHeight;
    }

    function sendChat() {
      let msg=document.getElementById("chatInput").value.trim();
      if (!msg) return;
      let history=JSON.parse(localStorage.getItem("chat_history")||"[]");
      history.push({user:playerName,text:msg});
      if (history.length>200) history.shift(); // ch·ªâ gi·ªØ 200 tin
      localStorage.setItem("chat_history",JSON.stringify(history));
      loadChatHistory();
      document.getElementById("chatInput").value="";
    }
  </script>
</body>
</html>
